{% extends "_base.html" %}

{% block title %}LQFB › Initiativen › Initiative {{data.initiative.result[0].id}}: {{data.initiative.result[0].name}}{% endblock %}

{% block navigation %}
{{ super() }}
  <ul class="breadcrumb">
    <li><a href="/"><i class="icon-home"></i></a> <span class="divider">/</span></li>
    <li><a href="/initiativen">Initiativen</a> <span class="divider">/</span></li>
    <li class="active">Initiative {{data.initiative.result[0].id}}: {{data.initiative.result[0].name}}</li>
  </ul>
{% endblock %}

{% block content %}
    <div class="page-header">
      <h1>
        <small>Initiative {{data.initiative.result[0].id}}</small>
        <br><i class="icon-file-alt"></i> {{data.initiative.result[0].name}}
      </h1>
    </div>

    {# collecting data for the supporter bar #}
    {% if data.initiative.result[0].supporter_count > data.initiative.result[0].issue_id|quorum %}
    {% set balken1 = data.initiative.result[0].issue_id|quorum %}
    {% set balken2 = data.initiative.result[0].supporter_count - data.initiative.result[0].issue_id|quorum %}
    {% else %}
    {% set balken1 = data.initiative.result[0].supporter_count %}
    {% set balken2 = 0 %}
    {% endif %}

    {# the supporter bar #}
    <div class="progress">
      <div class="bar" style="width: {{ ((balken1 / data.issue.result[0].population) * 100)|round(0)|int }}%">{{balken1}}</div>
      {% if balken2 == 0 %}
      <div class="bar bar-transparent" style="width: {{ (((data.initiative.result[0].issue_id|quorum - balken1) / data.issue.result[0].population) * 100)|round(0)|int }}%%"></div>
      <div class="bar bar-border-right"></div>
      {% else %}
      <div class="bar bar-border-right"></div>
      <div class="bar bar-success" style="width: {{ ((balken2 / data.issue.result[0].population) * 100)|round(0)|int }}%">{{balken2}}</div>
      {% endif %}
    </div>

    {% if data.initiative.result[0].schulze_rank %}
    <h2>Abstimmung</h2>
    <ul>
      <li>
        Abstimmungs-Rang: {{ data.initiative.result[0].rank }}
      </li>
      <li>
        Schulze-Rang: {{ data.initiative.result[0].schulze_rank }} (Schulze-Rang des Status Quo: {{ data.issue.result[0].status_quo_schulze_rank }})
      </li>
      <li>
        Zustimmungen: {{ data.initiative.result[0].positive_votes }}
      </li>
      <li>
        Ablehnungen: {{ data.initiative.result[0].negative_votes }}
      </li>
    </ul>

    <h3>Vergleiche</h3>
      
    <ul>
      {% for p in data.battle.result if p.winning_initiative_id == data.initiative.result[0].id %}
      <li>schlägt {{ p.losing_initiative_id }} ({{p.count}})</li>
      {% endfor %}
      {% for p in data.battle.result if p.losing_initiative_id == data.initiative.result[0].id %}
      <li>geschlagen von {{ p.winning_initiative_id }} ({{p.count}})</li>
      {% endfor %}
    </ul>
    {% endif %}

    <h2>Informationen</h2>
    <ul>
      <li>
        {{ data.initiative.result[0].supporter_count }} Unterstützer
      </li>
      <li>
        {{ data.initiative.result[0].issue_id|quorum }} Initiativquorum
      </li>
      <li>
        {{ data.issue.result[0].population }} Grundgesamtheit
      </li>
      <li>
        <a href="{{ data.initiative.result[0].discussion_url }}">Diskussion mit den Antragstellern</a>
      </li>
    </ul>

    <h2>Text</h2>
    <div class="well" id="initiative">
      <style>
      #initiative h1 { font-size: 2em; }
      #initiative h2 { font-size: 1.5em; }
      </style>
      {{ data.current_draft.result[0].content|safe }}
    </div>

    <p><strong>Stand: </strong>{{ data.current_draft.result[0].created|nicedate(timeago=False) }}</p>
{% endblock %}
